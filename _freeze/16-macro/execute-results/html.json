{
  "hash": "2c8fa875adadb89d89b5c069440a9d33",
  "result": {
    "markdown": "# Macros {#sec-macros}\n\n::: {.callout-note appearance=\"simple\" icon=\"false\"}\n+ Explanation of macros and their use.\n+ Activating Developer tab.\n+ Recording a macro with the macro recorder.\n+ Modify a macro.\n+ Create command button.\n+ Security settings. \n:::\n\nYou can automate a task that you have to perform regularly in Microsoft Excel with a macro. A macro consists of a series of commands and functions that are executed in succession by a single command or the press of a button.\n\nA macro is therefore primarily intended to be used for frequently occurring actions or for complex actions. By using a macro, efficiency can be increased and the chance of errors can be reduced.\n\nSimple macros consisting of a number of actions performed in succession can be recorded with the built-in macro recorder. Complex macros are programmed in the VBA programming language. Only simple macros are discussed here, you do not need any programming knowledge for this. \n\n::: {.callout-note}\nThe language in which the Excel macros are written is Visual Basic for Applications (VBA). The commands and functions of the macro are stored in a Visual Basic module. And with the Visual Basic editor, you can edit macros, copy macros from one module to another, copy macros between different workbooks, and rename modules and macros. \n:::\n\n## Developer tab {#sec-tab-developer}\n\no be able to record, edit and execute macros, the tab [Developers]{.uicontrol} must be made visible.\n\nA number of Excel functions, including those for Macros and VBA, are located under the [Developers]{.uicontrol} tab. This tab is not shown by default when Excel is installed and will therefore have to be made visible first. This is a one-time action.\n\n::: {.callout-warning}\nFirst check whether the tab [Developers]{.uicontrol} is present on the ribbon. If so, you can skip this task.\n\n![Tab ontwikkelaars.](images/macro/tab-developer.png){#fig-tab-developer}\n\n:::\n\n\n::: {#prp-tab-developer}\n1. Choose [File > Options > Customize Ribbon]{.uicontrol}.\n\n![Excel options to show the developer tab.](images/common/excel-options-developertab.png){#fig-excel-options-developertab}\n\n2. Select under Main Tabs [Developer]{.uicontrol} and click [OK]{.uicontrol}.\n\nThe tab [Developers]{.uicontrol} should now be visible on the ribbon (see @fig-tab-developer). \n\n:::\n\n## Recording macros {#sec-macros-recording}\n\nSimple macros can be created by recording the operations with the built-in **macro recorder**. After starting the recorder, all actions are recorded and converted into VBA code in the background. This continues until the recorder is stopped.\n\n::: {.callout-note}\nIn order to get a properly working macro, it is important to first perform the actions to be performed without recording and write them down in order. You can then use this script to record the actions with the macro recorder. \n:::\n\nThe button with which you can start recording macros is on the [Tab Developers]{.uicontrol} in the group [Code]{.uicontrol}, see @fig-tab-developer.\n\nWhen this button is clicked to start recording a macro, a dialog box first appears in which a number of properties of the macro can be entered.\n\n![Dialog box record macro.](images/macro/record-macro-dialogbox.png){#fig-record-macro-dialogbox}\n\n**Macro name**\n\nEach macro must have a name. To do this, Excel fills in the default text “Macro” followed by a digit. You can change this name by typing a different name.\n\nThe first character of the macro name has to be a letter. After that, you can use other characters such as letters, numbers, or underscore. Spaces are not allowed in a macro name. Always give meaningful names showing what the macro is going to do. The underscore can be used as a separator between words.\n\n**Shortcut key**\n\nMacros can be executed through the menu, but this can also be done using keyboard shortcuts. These are shortcuts with the [CTRL]{.uicontrol} key combined with a letter key. If you want to assign a keyboard shortcut to the macro then you can enter the letter in the box. Putting for example the letter A in the box, then the key combination [CTRL-A]{.uicontrol} is the shortcut that allows you to start the macro.\n\nIt is not required to assign a keyboard shortcut to a macro, but this can be very useful for frequently used macros.\n\n**Store macro in**\n\nThe locations where the macro can be stored are:\n\n+ This Workbook\n+ New Workbook\n+ Personal Macro Workbook\n\nIt is important to think thoroughly about it. If the macro is to be used only in the active workbook, choose [This Workbook]{.uicontrol}. Should the macro be used in other workbooks, so it is always available, then the [Personal Macro Workbook]{.uicontrol} is the best choice. The option [New workbook]{.uicontrol} is actually never used.\n\nYou should always specify the storage place. The default value is [This Workbook]{.uicontrol}.\n\n**Description**\n\nIt is recommended that you give a brief description of what the macro does. When you create the macro you know it, but after a while, you may forget. It is not mandatory to specify a description.\n\n::: {.callout-note}\nAll made choices can always be changed at a later stage.\n:::\n\n## Macro Cell Format {#sec-macros-cellformat}\n\n*Information need*\n\nCreate a macro that should format the text in the selected cell with the font Comic Sans MS, bold, italic, 16 pt, and red. The column width must be adjusted to the width of the text in the cell. The name of the macro should be [CellFormat]{.varname}.\n\n::: {#prp-macros-cellformat-record}\n**Record macro**\n\n1. Start with an empty worksheet and enter a text in a cell.\n\n2. Select the cell that contains the text.\n\n3. Choose [Developer tab > Record Macro (group Code)]{.uicontrol}.\n\n4. Enter in the dialog box the name and a description of the macro.\n\n![Properties macro CellFormat.](images/macro/record-macro-cellformat.png){#fig-record-macro-cellformat}\n\n5. Click [OK]{.uicontrol}.\n\n6. Perform the following actions on the selected cell [Right mouse click > Format Cells > tab Font]{.uicontrol} and make the following settings:\n\n   + Font: Comic Sans MS\n   + Font style: Bold Italic\n   + Size: 16\n   + Color: Red\n\n7. Choose tab [tab Home > Format (group Cells) > Autofit Column Width]{.uicontrol}.\n\n8. Choose [Developer tab > Stop Recording (group Code)]{.uicontrol}.\n\n![Button stop recording macro.](images/macro/record-macro-stop.png){#fig-record-macro-stop}\n\n:::\n\nNow the macro can be tested for a correct operation.\n\n::: {#prp-macros-cellformat-test}\n**Testing macro**\n\n1. Enter a text in another cell and select this cell.\n\n2. Choose [tab Developers > Macros (Program code group)]{.uicontrol}.\n\n3. Select macro [Cell Format]{.uicontrol} and click [Run]{.uicontrol}. \n\n![Dialog box macro CellFormat.](images/macro/macro-cellformat-run.png){#fig-macro-cellformat-run}\n\n4. Verify that the cell is correctly formatted.\n\n5. Save the workbook as [Excel Macro Workbook (*.xslm)]{.uicontrol} with the name `Cell Format.xlsm`.\n\n:::\n\n::: {.callout-warning}\nWhen you want to save a workbook with macros, Excel suggests to save it as an Excel workbook with the extension `*.xlsx`. However, in this format, no macros can be stored. You should change this yourself in an **Excel workbook with macros** with the extension `*.xlsm`.\n:::\n\n## Editing Macros {#sec-macros-cellformat-editing}\n\nTo perform this task, it is necessary that the macro [CellFormat]{.varname} in @prp-macros-cellformat-test is created. \n\nA macro can be changed without recording the macro again. Both the options of the macro as the program code can be viewed and modified.\n\n*Information need*\n\nMake the following changes to the [CellFormat]{.varname} macro:\n\n+ Assign the shortcut key “Control t”.\n+ Change the font size to 18 pt.\n\n::: {#prp-macros-cellformat-editing}\nContinue with the file from @prp-macros-cellformat-test.\n\n1. If necessary, open the file.\n\n2. Choose [Developer tab > Macros (group Code)]{.uicontrol}.\n\nYou now get the dialog box with available macros again, see @fig-macro-cellformat-run. \n\n3. Select macro [CellFormat]{.varname} and then [Options]{.uicontrol}.\n\n![Options macro CellFormat.](images/macro/macro-cellformat-options.png){#fig-macro-cellformat-options}\n\n4. Enter the letter `t` in the box for the shortcut key and change in the description 16pt in 18pt. Then click [OK]{.uicontrol}.\n\n5. Choose now [Edit]{.uicontrol}.\n\nA new Microsoft Visual Basic window will now appear with the program code of the macro in the code screen. In this code you will find 16 for the text size on two places:\n\n+ `Format cell in Comic Sans, 16pt, bold, italic and red`\n+ `.Size = 16`\n\n6. Change it to `18` in both places.\n\n7. Close the Microsoft Visual Basic window with the close button in the upper right corner.\n\n8.  Test the macro on a cell with text using the keyboard shortcut [CTRL t]{.uicontrol}.\n\n:::\n\n## Creating a Command Button {#sec-macros-cellformat-commandbutton}\n\nYou can run a macro in one of the following ways:\n\n+ Via the menu [Developers tab > Macros > select macro > Run]{.uicontrol}.\n+ Via a hotkey when one is assigned to the macro.\n+ Via a command button for the macro.\n\nThis task creates a command button on the worksheet for the previously created macro [Cell Format]{.varname}.\n\n::: {#prp-macros-cellformat-commandbutton}\nContinue with the file from @prp-macros-cellformat-editing.\n\n1. If necessary, open the file.\n\n2. Choose [Developer tab > Insert (group Controls)]{.uicontrol}.\n\n3. Click on control [Button (Form Control)]{.uicontrol}\n\n![Form controls, the highlighted one is Button (form control).](images/macro/form-controls.png){#fig-form-controls}\n\nThe cursor will change to a `+`. With this cursor, you can draw a rectangle in the worksheet for the button.\n\n4. Click the left mouse button and draw a rectangle with the desired dimensions for the button somewhere in the worksheet. Then release the left mouse button. The ***Assign macro*** dialog box then appears.\n\n![Link macro CellFormat to the button.](images/macro/macro-cellformat-assign.png){#fig-macro-cellformat-assign}\n\n5. Select the macro [CellFormat]{.varname} and click [OK]{.uicontrol}.\n\nThe drawn rectangle will turn into a button with a text like `Button 1`.\n\n6. Select the text on the button and change it to a more appropriate text, for example, `Cell format`.\n\n![Command button.](images/macro/macro-cellformat-button.png){#fig-macro-cellformat-button}\n\n7. Deselect the button by clicking anywhere in the worksheet.\n\n8. Test the macro via the command button on a cell with some text.\n\n:::\n\n## Macro Security {#sec-macros-security}\n\nAn overview of the security settings and how to change it.\n\n**Change settings**\n\nIf you want to view or change the security settings for macros, then you need to click on [Developer tab > Macro Security (group Code)]{.uicontrol}.\n\n![Macro security button on the ribbon.](images/macro/macro-security-button.png){#fig-macro-security-button}\n\nThe dialog box ***Trust Center*** appears.\n\n![Macro settings in Trust Center.](images/macro/trust-center-macro-settings.png){#fig-trust-center-macro-settings}\n\n\n|Setting                          |Explanation                                                                    |\n|---------------------------------|-------------------------------------------------------------------------------|\n|Disable all macros without notification|Choose this option if you don't trust macros. All macros in documents are disabled, as well as the security alerts about macros. Documents that contain unsigned macros that you do trust can be saved in a trusted location. Documents in trusted locations are executed without control by the security system.|\n|Disable all macros with notification|This is the default setting. Choose this option when you want to disable macros, but want to receive security alerts if macros are present. This way you can choose if you want to enable each macro.|\n|Disable all macros except digitally signed macros|The creator of a macro can digitally sign it. When you consider this as a trusted authority then the macro will be executed without warnings. All unsigned macros will be disabled without notification.|\n|Enable all macros|Choose this option when you want to run all macros. This option is not recommended because the computer is then vulnerable for malicious macros.|\n\n:  Overview of Macro Settings. {#tbl-macro-security-settings tbl-colwidths=\"[25,75]\"}\n\n## Tips {#sec-macros-tips}\n\n### Relative References {#sec-macros-tips-references}\n\nRecorded macros will use absolute cell references by default. This means that the exact locations of cells, rows, and columns in the program code of the macro will be used. The macro works then always at the same addresses.\n\nWhen you want to use relative references in the macro you need to click on the button Use [Relative References]{.uicontrol}.\n\n![Relative references in macros.](images/macro/record-macro-relative-references.png){#fig-record-macro-relative-references}\n\n::: {.callout-warning}\nThis setting remains active until you undo the setting by clicking on this button again.\n:::\n\n### Deleting macros {#sec-macros-tips-deleting}\n\nMacros can be deleted by [Developer tab > Macros (group Code) > Select macro > Delete]{.uicontrol}.\n\n## Exercises {#sec-macros-exercises}\n\n::: {#exr-macr001}\n**Background color (macr001)**\n\nRecord a macro that gives the active cell a gray background color.\n\n\n<div class='webex-solution'><button>Answer</button>\n\nAn example of a solution.\n\n```\nSub Background_Gray()\n'\n' Lightgray background for active cell\n'\n    With Selection.Interior\n        .Pattern = xlSolid\n        .PatternColorIndex = xlAutomatic\n        .ThemeColor = xlThemeColorDark1\n        .TintAndShade = -0.14996795556505\n        .PatternTintAndShade = 0\n    End With\nEnd Sub\n```\n\n</div>\n\n:::\n\n::: {#exr-macr002}\n**Percentage formatting (macr002)**\n\nRecord a macro with the name PercentageFormat that is formatting a numeric value as a percentage with 1 decimal and also centers the content in the cell.\n\n\n<div class='webex-solution'><button>Answer</button>\n\nAn example of a solution.\n\n```\nSub PercentageFormat()\n'\n' Numeric value formatted as percentage with 1 dec. and horizontally centered\n'\n    Selection.NumberFormat = \"0.0%\"\n    With Selection\n        .HorizontalAlignment = xlCenter\n    End With\nEnd Sub\n```\n\n</div>\n\n:::\n\n::: {#exr-macr003}\n**Formatting cell A1 (macr003)**\n\nRecord a macro that performs the following:\n\n-   Height of row 1 is 18\n-   Width of column 1 is 3\n-   Font of text in cell A1 is Tahoma 14, bold, blue color\n\n\n<div class='webex-solution'><button>Answer</button>\n\nAn example of a solution.\n\n```\nSub FormatA1()\n'\n' exercise macr003\n'\n    Rows(\"1:1\").Select\n    Selection.RowHeight = 18\n    Columns(\"A:A\").Select\n    Selection.ColumnWidth = 3\n    Range(\"A1\").Select\n    With Selection.Font\n        .Name = \"Tahoma\"\n        .Size = 14\n        .Bold = True\n        .Color = -4165632\n    End With\nEnd Sub\n```\n\n</div>\n\n:::\n\n::: {#exr-macr004}\n**Printing gridlines (macr004)**\n\nCreate a macro that ensures that the grid lines will be printed at printing.\n\n::: {.callout-note}\nYou can find this property at the [tab Page Layout > Page Setup > tab Sheet]{.uicontrol}.\n:::\n\n\n<div class='webex-solution'><button>Answer</button>\n\nAn example of a solution.\n\n```\nSub Print_Gridlines()\n'\n' exercise macr004\n'\n    With ActiveSheet.PageSetup\n        .PrintGridlines = True\n    End With\nEnd Sub\n```\n\n</div>\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}